# ============================================================================
# Python 3.11 Compatibility Constraints for Datalix VPS Deployment
# ============================================================================
# Use with: pip install -r requirements.txt -c constraints-py311.txt --prefer-binary
#
# This file constrains packages to ensure Python 3.11 compatibility and
# prevents installation issues on production VPS environments.
# ============================================================================

# ============================================================================
# CORE SYSTEM PACKAGES (Critical - must have Python 3.11 wheels)
# ============================================================================
setuptools>=69.0.0,<71.0.0
wheel>=0.42.0
pip>=24.0

# ============================================================================
# NUMERICAL COMPUTING (Critical - compiled packages)
# ============================================================================
numpy>=1.26.0,<2.0.0
pandas>=2.1.0,<2.3.0

# ============================================================================
# AI/ML PACKAGES (Large compiled packages - use binary wheels)
# ============================================================================
# PyTorch - ensure Python 3.11 compatible version
torch>=2.2.0,<2.3.0
# Transformers - ensure compatibility with torch and Python 3.11
transformers>=4.37.0,<4.40.0
# Scikit-learn - compiled package
scikit-learn>=1.4.0,<1.5.0
# Spacy - compiled NLP package
spacy>=3.7.0,<3.8.0

# ============================================================================
# WEB FRAMEWORK (Critical for FastAPI compatibility)
# ============================================================================
fastapi>=0.109.0,<0.112.0
uvicorn>=0.27.0,<0.28.0
gunicorn>=21.2.0,<22.0.0
pydantic>=2.5.0,<2.7.0
pydantic-settings>=2.1.0,<2.3.0

# ============================================================================
# DATABASE (Critical for Supabase and PostgreSQL)
# ============================================================================
sqlalchemy>=2.0.27,<2.0.30
psycopg2-binary>=2.9.9,<3.0.0
asyncpg>=0.29.0,<0.30.0
alembic>=1.13.0,<1.14.0

# ============================================================================
# SUPABASE SDK (Must be pydantic v2 compatible)
# ============================================================================
supabase>=2.0.0,<2.5.0
# Don't constrain httpx, gotrue, etc - let supabase manage its dependencies

# ============================================================================
# PDF GENERATION (Has C dependencies - may need system libraries)
# ============================================================================
reportlab>=4.0.0,<4.2.0
Pillow>=10.0.0,<11.0.0
# WeasyPrint can be problematic - ensure compatible version
weasyprint>=60.0,<62.0

# ============================================================================
# CRYPTOGRAPHY (Compiled package)
# ============================================================================
cryptography>=41.0.0,<43.0.0
PyJWT>=2.8.0,<3.0.0
passlib>=1.7.4,<2.0.0

# ============================================================================
# BACKGROUND TASKS
# ============================================================================
celery>=5.3.0,<5.4.0
redis>=5.0.0,<5.1.0

# ============================================================================
# MONITORING (Generally safe but constrain for stability)
# ============================================================================
sentry-sdk>=1.40.0,<2.0.0
prometheus-client>=0.20.0,<0.21.0
psutil>=5.9.0,<6.0.0
